<html>
    <head>
        <title>index.ejs</title>
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.12.4.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

        <script>   
            function register(){
                //idê°’ ì§€ì •ì•ˆí•´ë„ ìë™ìœ¼ë¡œ ìƒê¹€.
                    var form = document.getElementById("form_register");
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/user/register',
                        data: {
                            id: form.id.value,
                            pw: form.pw.value,
                            name: form.name.value
                        }
                    })
                    .then((rep) => {
                        return rep.data;
                    })
                    .then((data) => {
                        alert(form.name.value + "ë‹˜ğŸŒ± íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!");
                        // let html = 
                        // "<tr id='tr_" + data.id +"'><td>" + data.id + "</td><td>" + form.name.value + "</td><td>" + form.comment.value + "</td>" + "<td><button type='button' onclick='editComment(" + data.id + ");'>ìˆ˜ì •</button></td>"+ "<td><button type='button' onclick='deleteComment(" + data.id + ");'>ì‚­ì œ</button></td></tr>";
                        // $("table").append(html);
                    }); // ë¬¸ìì—´ì„ íƒœê·¸í˜•íƒœë¡œ ì¶”ê°€í•´ì¤Œ.
            }

            function login(){
                //idê°’ ì§€ì •ì•ˆí•´ë„ ìë™ìœ¼ë¡œ ìƒê¹€.
                    var form = document.getElementById("form_login");
                    axios({
                        method: 'post',
                        url: 'http://localhost:8080/user/login',
                        data: {
                            id: form.id.value,
                            pw: form.pw.value,
                        }
                        // methodë¥¼ getì²˜ë¦¬ í–ˆëŠ”ë° ë‚´ìš©ì´ ë…¸ì¶œë˜ë‹ˆê¹Œ postë¡œ ë°”ê¿”ì£¼ê¸°.
                    })
                    .then((rep) => {
                        return rep.data;
                    })
                    .then((data) => {
                        alert(data+ "ë‹˜ ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤!");
                    }); 
                // alert ë°©ì‹ë§ê³  í™”ë©´ ë‚´ì—ì„œ ë³´ì´ê²Œ í•˜ëŠ” ë°©ë²• ë­ì˜€ì§€?
                res.render("login");
            }



            function editComment( id ) {
                // idë¥¼ ê°€ì ¸ì™€ì„œ ì…€ë ‰íŠ¸ë¡œ ê°€ì ¸ì˜¨ë‹¤. idë¥¼ whereì¡°ê±´ì ˆì„ ê±¸ì–´ì„œ í•œê°œì˜ ê°’ë§Œ ê°€ì ¸ì˜¬ ê²ƒì„.
                axios({
                    method: 'get',
                    url: 'http://localhost:8080/visitor/get?id=' + id
                    // paramsë¡œ ë”°ë¡œ ì•ˆì¨ì£¼ê³  urlì—ì„œ ë¶™ì—¬ ë„£ì–´ë„ ë¨.
                })
                .then((rep) => { return rep.data })
                .then((data) => {
                    console.log(data);

                    var form = document.getElementById("form_comment");
                    form.name.value = data.result.name;
                    // ëª¨ë¸ì— ì €ì¥ëœ ê°’ì„ formìœ¼ë¡œ ì½ì–´ì˜¤ëŠ” ê²ƒ.
                    form.comment.value = data.result.comment; 

                    var html = 
                    "<button type='button' onclick='editDo(" + id + ");'> ìˆ˜ì • </button>";
                    "<button type='button' onclick='editCancel();'>ì·¨ì†Œ</button>"

                    document.getElementById("button-group").innerHTML = html;
                }); 
                    // { data : result };
                    // [ { id: 0, name: 1 }]
                    // req.data.data[0].id;
            } 
            // ê²½ë¡œë¥¼ ë§Œë“¤ì–´ì•¼ í•˜ë‹ˆê¹Œ ë¼ìš°í„°ë¡œ ê°€ì.
            
            function editDo( id ){
                // ì •ë³´ë¥¼ ìƒˆë¡­ê²Œ ìˆ˜ì •í•˜ëŠ” í•¨ìˆ˜
                var form = document.getElementById("form_comment");
                axios({
                    //  putì€ ì „ë¶€ ë°”ê¾¸ëŠ” ê²ƒ, patchëŠ” íŠ¹ì •ë¶€ë¶„ì„ ë°”ê¾¸ëŠ” ê²ƒ
                    method: 'patch',
                    url : 'http://localhost:8080/visitor/edit',
                    data : {
                        id: id,
                        name: form.name.value, 
                        comment: form.comment.value
                    }
                }).then ((rep) => { return rep.data ; })
                .then((data) => {
                    alert( data );

                    var tr = document.getElementById("tr_" + id);
                    var children = tr.children;

                    $(children[1]).text(form.name.value); 
                    // trì˜ í•˜ìœ„ íƒœê·¸ì¤‘ 2ë²ˆì§¸ì¸ name ìˆ˜ì •. 
                    $(children[2]).text(form.comment.value);
                    console.log( children );
                })
            }

            function deleteComment( id ) {
                axios({
                    method : 'delete',
                    url: 'http://localhost:8080/visitor/delete',
                    data: { id: id}
                    // ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ì“°ê¸° ìœ„í•´ ë³´ë‚´ì¤€ë‹¤. 
                }).then((rep) => { return rep.data; })
                .then((data) => { 
                    alert( data );
                    // var tr = document.getElementById("tr_"+ id);
                    // $( tr ).remove(); 
                    // tríƒœê·¸ ë™ì ìœ¼ë¡œ ì§€ìš°ê¸°.
                    $("#tr_" + id ).remove();
                });
            }

            function editCancel() {
                var form = document.getElementById("form_comment");
                form.reset();

                var html = "<button type='button' onclick='writeComment();'>ë“±ë¡</button>";
                document.getElementById("button-group").innerHTML = html;
            }
            
        </script>
    </head>
    <body>
        <form id="form_register" method="POST" style="text-align: center;">  
        <!-- form action ë¶€ë¶„ ì§€ì›€. -->
            <div style="color: #58dd78; text-align: center; text-size-adjust: 100%; font-size:xx-large; ">SeSAC</div><br>
            <fieldset style="width: 500p" >
                <legend style="text-align: center;"><span style="color:#58dd78;">SeSAC</span>ì˜ ìƒˆë¡œìš´ ìƒˆì‹¹ì´ ë˜ì–´ì£¼ì„¸ìš”!</legend>
                <label for="">
                    ì•„ì´ë”” <input type="text" name="id"> <br>
                </label>
                <label for="">
                    ë¹„ë°€ë²ˆí˜¸ <input type="password" name="pw"> <br>
                </label>
                <label for="">
                    ì´ë¦„ <input type="text" name="name"> <br>
                </label>
                <div>
                    <button type="button" onclick="register();">ìƒˆì‹¹ ì‹êµ¬ ë“±ë¡</button>
                </div>
            </fieldset>
        </form>
        
        <form method="post" action="user/login" style="text-align: center;">  
            <fieldset style="width: 500p" >
                <legend style="text-align: center;"><span style="color:#58dd78;">SeSAC</span> ë¡œê·¸ì¸</legend>
                <label for="">
                    ì•„ì´ë”” <input type="text" name="id"> <br>
                </label>
                <label for="">
                    ë¹„ë°€ë²ˆí˜¸ <input type="password" name="pw"> <br>
                </label>
                <div>
                    <button>ë¡œê·¸ì¸</button>
                </div>
            </fieldset>
        </form>
    </body>
</html>



